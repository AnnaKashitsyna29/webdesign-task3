<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Jumper - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Press Start 2P", monospace, "Courier New", Arial,
          sans-serif;
        background: #87ceeb; /* Sky blue background */
        color: #000;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background-image: radial-gradient(#7fbfff 2px, transparent 2px),
          radial-gradient(#7fbfff 2px, transparent 2px);
        background-size: 40px 40px;
        background-position: 0 0, 20px 20px;
      }

      .game-container {
        background: #2d3436;
        border-radius: 8px;
        padding: 20px;
        box-shadow: inset -5px -5px 0px rgba(0, 0, 0, 0.5),
          inset 5px 5px 0px rgba(255, 255, 255, 0.3), 0 0 0 4px #ddd,
          0 0 0 8px #2d3436;
        border: 4px solid #ddd;
        max-width: 840px;
        width: 100%;
      }

      h1 {
        text-align: center;
        color: #ffd700; /* Gold color */
        margin-bottom: 10px;
        font-size: 2.5em;
        text-shadow: 3px 0 0 #e17055, -3px 0 0 #e17055, 0 3px 0 #e17055,
          0 -3px 0 #e17055;
        letter-spacing: 2px;
        font-family: "Press Start 2P", monospace;
      }

      .subtitle {
        text-align: center;
        color: #55efc4; /* Green color */
        margin-bottom: 20px;
        font-size: 0.8em;
        font-family: "Press Start 2P", monospace;
      }

      canvas {
        background: #87ceeb;
        border-radius: 4px;
        border: 4px solid #ddd;
        display: block;
        margin: 0 auto 20px;
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      button {
        padding: 12px 24px;
        border: 4px solid #ddd;
        border-top-color: white;
        border-left-color: white;
        border-radius: 0;
        font-size: 0.8em;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 120px;
        justify-content: center;
        background: #aab2bd;
        font-family: "Press Start 2P", monospace;
        text-shadow: 1px 1px 0 #000;
        box-shadow: inset -3px -3px 0px rgba(0, 0, 0, 0.3),
          inset 2px 2px 0px rgba(255, 255, 255, 0.4);
      }

      button:hover {
        background: #8794a8;
        transform: none;
      }

      .btn-start {
        background: #00b894;
        color: white;
      }

      .btn-pause {
        background: #6c5ce7;
        color: white;
      }

      .btn-restart {
        background: #e17055;
        color: white;
      }

      .ui-overlay {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding: 0 10px;
      }

      .ui-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.7em;
        font-weight: bold;
        font-family: "Press Start 2P", monospace;
        color: #000;
        text-shadow: 1px 1px 0 #fff;
      }

      .score {
        color: #ffd700;
      }
      .lives {
        color: #ff6b6b;
      }
      .level {
        color: #55efc4;
      }

      .screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 10;
      }

      .screen.active {
        display: flex;
      }

      .screen-content {
        background: #2d3436;
        padding: 40px;
        border-radius: 8px;
        text-align: center;
        border: 8px solid #ddd;
        max-width: 500px;
        width: 90%;
        box-shadow: inset -5px -5px 0px rgba(0, 0, 0, 0.5),
          inset 5px 5px 0px rgba(255, 255, 255, 0.3);
        font-family: "Press Start 2P", monospace;
      }

      .screen h2 {
        color: #ffd700;
        margin-bottom: 20px;
        font-size: 1.2em;
        text-shadow: 2px 0 0 #e17055, -2px 0 0 #e17055, 0 2px 0 #e17055,
          0 -2px 0 #e17055;
      }

      .screen p {
        margin-bottom: 20px;
        font-size: 0.6em;
        color: #fff;
      }

      .controls-info {
        background: #2d3436;
        padding: 20px;
        border-radius: 4px;
        margin-top: 20px;
        border: 4px solid #ddd;
        box-shadow: inset -3px -3px 0px rgba(0, 0, 0, 0.3),
          inset 2px 2px 0px rgba(255, 255, 255, 0.4);
      }

      .controls-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 15px;
      }

      .control-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        padding: 10px;
        background: #aab2bd;
        border: 3px solid #ddd;
        border-top-color: white;
        border-left-color: white;
        box-shadow: inset -2px -2px 0px rgba(0, 0, 0, 0.3),
          inset 1px 1px 0px rgba(255, 255, 255, 0.4);
      }

      .control-item kbd {
        background: #00b894;
        color: white;
        padding: 8px 12px;
        border: 3px solid #ddd;
        border-top-color: white;
        border-left-color: white;
        font-family: "Press Start 2P", monospace;
        font-size: 0.5em;
        min-width: 60px;
        text-align: center;
        box-shadow: inset -2px -2px 0px rgba(0, 0, 0, 0.3),
          inset 1px 1px 0px rgba(255, 255, 255, 0.4);
      }

      footer {
        text-align: center;
        margin-top: 20px;
        color: #636e72;
        font-size: 0.5em;
        font-family: "Press Start 2P", monospace;
      }

      .coins-display {
        color: #ffd700;
        font-size: 0.7em;
        margin: 10px 0;
        text-shadow: 1px 1px 0 #000;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>Pixel Jumper</h1>
      <p class="subtitle">
        Legendary 2D Platformer, sdelano Kashitsynoy Entertainment
      </p>

      <div class="ui-overlay">
        <div class="ui-item score">
          <span>üèÜ</span>
          <span id="score">0</span>
        </div>
        <div class="ui-item lives">
          <span>‚ù§Ô∏è</span>
          <span id="lives">3</span>
        </div>
        <div class="ui-item level">
          <span>üéØ</span>
          <span id="level">1/3</span>
        </div>
        <div class="ui-item coins-display">
          <span>üí∞</span>
          <span id="coinsDisplay">0/0</span>
        </div>
      </div>

      <canvas id="gameCanvas" width="800" height="450"></canvas>

      <div class="controls">
        <button id="startBtn" class="btn-start"><span>‚ñ∂Ô∏è</span> –°—Ç–∞—Ä—Ç</button>
        <button id="pauseBtn" class="btn-pause"><span>‚è∏Ô∏è</span> –ü–∞—É–∑–∞</button>
        <button id="restartBtn" class="btn-restart">
          <span>üîÑ</span> –†–µ—Å—Ç–∞—Ä—Ç
        </button>
      </div>

      <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞ -->
      <div id="startScreen" class="screen active">
        <div class="screen-content">
          <h2>Pixel Jumper</h2>
          <p>–°–æ–±–µ—Ä–∏ –≤—Å–µ –º–æ–Ω–µ—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ!</p>
          <button
            id="playBtn"
            class="btn-start"
            style="margin: 20px 0; padding: 15px 30px; font-size: 1.2em"
          >
            <span>‚ñ∂Ô∏è</span> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
          </button>
          <div class="controls-info">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h3>
            <div class="controls-grid">
              <div class="control-item">
                <kbd>A</kbd>
                <kbd>D</kbd>
                <span>–î–≤–∏–∂–µ–Ω–∏–µ</span>
              </div>
              <div class="control-item">
                <kbd>W</kbd>
                <kbd>Space</kbd>
                <span>–ü—Ä—ã–∂–æ–∫</span>
              </div>
              <div class="control-item">
                <kbd>P</kbd>
                <span>–ü–∞—É–∑–∞</span>
              </div>
              <div class="control-item">
                <kbd>R</kbd>
                <span>–†–µ—Å—Ç–∞—Ä—Ç</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω –ø–∞—É–∑—ã -->
      <div id="pauseScreen" class="screen">
        <div class="screen-content">
          <h2>‚è∏Ô∏è –ü–∞—É–∑–∞</h2>
          <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
          <button id="resumeBtn" class="btn-start" style="margin-top: 20px">
            <span>‚ñ∂Ô∏è</span> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
          </button>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω Game Over -->
      <div id="gameOverScreen" class="screen">
        <div class="screen-content">
          <h2>üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
          <p>–í–∞—à —Å—á–µ—Ç: <span id="finalScore">0</span></p>
          <p>–£—Ä–æ–≤–µ–Ω—å: <span id="finalLevel">1</span></p>
          <button
            id="restartAfterGameOverBtn"
            class="btn-start"
            style="margin-top: 20px"
          >
            <span>üîÑ</span> –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
          </button>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è -->
      <div id="levelCompleteScreen" class="screen">
        <div class="screen-content" style="background: rgba(46, 204, 113, 0.9)">
          <h2>üèÜ –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!</h2>
          <p>
            –ú–æ–Ω–µ—Ç—ã: <span id="coinsCollected">0</span>/<span id="totalCoins"
              >0</span
            >
          </p>
          <p>–ë–æ–Ω—É—Å: <span id="bonusPoints">0</span> –æ—á–∫–æ–≤</p>
          <button id="nextLevelBtn" class="btn-start" style="margin-top: 20px">
            <span>‚û°Ô∏è</span> –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
          </button>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã -->
      <div id="victoryScreen" class="screen">
        <div class="screen-content" style="background: rgba(241, 196, 15, 0.9)">
          <h2>üëë –ü–æ–±–µ–¥–∞!</h2>
          <p>–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ 3 —É—Ä–æ–≤–Ω—è!</p>
          <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="victoryScore">0</span></p>
          <button id="playAgainBtn" class="btn-start" style="margin-top: 20px">
            <span>üîÑ</span> –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
          </button>
        </div>
      </div>

      <footer>
        Pixel Jumper ¬© 2024 | –í—Å–µ –º–æ–Ω–µ—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
      </footer>
    </div>

    <script>
      // –ü—Ä–æ—Å—Ç–∞—è –∏–≥—Ä–∞ —Å —É—Ä–æ–≤–Ω—è–º–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
      class SimpleGame {
        constructor() {
          this.canvas = document.getElementById("gameCanvas");
          this.ctx = this.canvas.getContext("2d");
          this.state = "menu"; // menu, playing, paused, gameOver, levelComplete, victory
          this.score = 0;
          this.lives = 3;
          this.currentLevel = 1;
          this.totalLevels = 3;
          this.coinsCollected = 0;
          this.totalCoins = 0;

          // –•—Ä–∞–Ω–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
          this.levelData = this.createLevelData();

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
          this.loadCurrentLevel();
          this.setupInput();
          this.setupUI();
          this.updateUI();

          console.log("–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞");
        }

        createLevelData() {
          return [
            {
              // –£—Ä–æ–≤–µ–Ω—å 1
              id: 1,
              name: "–û–±—É—á–µ–Ω–∏–µ",
              platforms: [
                { x: 50, y: 380, width: 150, height: 20, moving: false }, // Starting platform - wide for easy start
                {
                  x: 250,
                  y: 340,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 230,
                  maxX: 270,
                }, // Moving platform
                { x: 400, y: 380, width: 100, height: 20, moving: false }, // Stationary platform
                {
                  x: 550,
                  y: 300,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: -1,
                  minX: 530,
                  maxX: 570,
                }, // Moving platform
                {
                  x: 400,
                  y: 200,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 380,
                  maxX: 420,
                }, // Moving platform
                { x: 250, y: 160, width: 100, height: 20, moving: false }, // Stationary platform
                {
                  x: 100,
                  y: 120,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 80,
                  maxX: 120,
                }, // Moving platform to finish
              ],
              coins: [
                { x: 125, y: 320 },
                { x: 300, y: 280 },
                { x: 450, y: 240 },
                { x: 600, y: 200 },
                { x: 450, y: 140 },
                { x: 300, y: 100 },
                { x: 150, y: 60 },
              ],
              startX: 70,
              startY: 310,
              finishX: 150,
              finishY: 60,
            },
            {
              // –£—Ä–æ–≤–µ–Ω—å 2
              id: 2,
              name: "–°–ª–æ–∂–Ω–µ–µ",
              platforms: [
                { x: 50, y: 380, width: 120, height: 20, moving: false }, // Starting platform
                {
                  x: 220,
                  y: 340,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 200,
                  maxX: 240,
                }, // Moving platform
                {
                  x: 370,
                  y: 300,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: -1,
                  minX: 350,
                  maxX: 390,
                }, // Moving platform
                {
                  x: 550,
                  y: 300,
                  width: 100,
                  height: 20,
                  moving: false,
                }, // Moving platform
                {
                  x: 630,
                  y: 220,
                  width: 100,
                  height: 20,
                  moving: false,
                }, // Moving platform
                {
                  x: 430,
                  y: 140,
                  width: 100,
                  height: 20,
                  moving: false,
                }, // Moving platform
                {
                  x: 220,
                  y: 100,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 200,
                  maxX: 240,
                }, // Moving platform to finish
              ],
              coins: [
                { x: 110, y: 320 },
                { x: 270, y: 280 },
                { x: 420, y: 240 },
                { x: 570, y: 200 },
                { x: 720, y: 160 },
                { x: 570, y: 120 },
                { x: 420, y: 80 },
                { x: 270, y: 40 },
              ],
              startX: 70,
              startY: 310,
              finishX: 270,
              finishY: 40,
            },
            {
              // –£—Ä–æ–≤–µ–Ω—å 3
              id: 3,
              name: "–≠–∫—Å–ø–µ—Ä—Ç",
              platforms: [
                { x: 50, y: 380, width: 100, height: 20, moving: false }, // Starting platform
                {
                  x: 200,
                  y: 340,
                  width: 80,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 180,
                  maxX: 220,
                }, // Moving platform
                {
                  x: 330,
                  y: 300,
                  width: 100,
                  height: 20,
                  moving: true,
                  speed: -1,
                  minX: 310,
                  maxX: 350,
                }, // Moving platform
                {
                  x: 460,
                  y: 360,
                  width: 150,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 440,
                  maxX: 480,
                }, // Moving platform
                {
                  x: 640,
                  y: 290,
                  width: 80,
                  height: 20,
                  moving: true,
                  speed: -1,
                  minX: 620,
                  maxX: 660,
                }, // Moving platform
                {
                  x: 480,
                  y: 220,
                  width: 80,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 460,
                  maxX: 500,
                }, // Moving platform
                {
                  x: 320,
                  y: 140,
                  width: 80,
                  height: 20,
                  moving: true,
                  speed: -1,
                  minX: 300,
                  maxX: 340,
                }, // Moving platform
                {
                  x: 180,
                  y: 100,
                  width: 80,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 160,
                  maxX: 200,
                }, // Moving platform

                {
                  x: 480,
                  y: 20,
                  width: 80,
                  height: 20,
                  moving: true,
                  speed: 1,
                  minX: 460,
                  maxX: 500,
                }, // Moving platform
              ],
              coins: [
                { x: 100, y: 320 },
                { x: 240, y: 280 },
                { x: 370, y: 240 },
                { x: 500, y: 200 },
                { x: 640, y: 160 },
                { x: 500, y: 120 },
                { x: 360, y: 80 },
                { x: 220, y: 40 },
              ],
              startX: 70,
              startY: 310,
              finishX: 220,
              finishY: 50,
            },
          ];
        }

        loadCurrentLevel() {
          const level = this.levelData[this.currentLevel - 1];
          console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å ${this.currentLevel}: ${level.name}`);

          // –°–æ–∑–¥–∞–µ–º —Å–≤–µ–∂–∏–µ –º–æ–Ω–µ—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          this.coins = level.coins.map((coin) => ({
            x: coin.x,
            y: coin.y,
            collected: false,
          }));

          this.totalCoins = this.coins.length;
          this.coinsCollected = 0;

          // –ò–≥—Ä–æ–∫
          this.player = {
            x: level.startX,
            y: level.startY,
            width: 32,
            height: 64,
            vx: 0,
            vy: 0,
            onGround: false,
            facingRight: true,
            canJump: true,
            jumpsUsed: 0, // For double jump
            maxJumps: 2, // Allow double jump
            lastJumpTime: 0, // Time of last jump
            jumpTapCount: 0, // Count of jump taps
          };

          // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ —Ñ–∏–Ω–∏—à
          this.platforms = level.platforms;
          this.finish = {
            x: level.finishX,
            y: level.finishY,
            width: 30,
            height: 50,
          };

          this.updateUI();
        }

        setupInput() {
          // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
          document.addEventListener("keydown", (e) => {
            const key = e.key.toLowerCase();
            this.keys[key] = true;

            if (e.key === " ") e.preventDefault();
            if (key === "p") this.togglePause();
            if (key === "r") this.restart();
          });

          document.addEventListener("keyup", (e) => {
            const key = e.key.toLowerCase();
            this.keys[key] = false;

            // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä—ã–∂–æ–∫ —Å–Ω–æ–≤–∞ –∫–æ–≥–¥–∞ –æ—Ç–ø—É—Å–∫–∞–µ–º –∫–ª–∞–≤–∏—à—É
            if (key === "w" || key === " " || key === "arrowup") {
              if (this.player) this.player.canJump = true;
            }
          });

          this.keys = {};
        }

        setupUI() {
          // –ö–Ω–æ–ø–∫–∏
          const addClickListener = (id, handler) => {
            const element = document.getElementById(id);
            if (element) {
              element.addEventListener("click", handler.bind(this));
            }
          };

          addClickListener("playBtn", () => this.start());
          addClickListener("startBtn", () => this.start());
          addClickListener("pauseBtn", () => this.togglePause());
          addClickListener("resumeBtn", () => this.togglePause());
          addClickListener("restartBtn", () => this.restart());
          addClickListener("restartAfterGameOverBtn", () => this.restart());
          addClickListener("nextLevelBtn", () => this.nextLevel());
          addClickListener("playAgainBtn", () => this.restart());

          // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã –∫—Ä–æ–º–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ
          this.hideAllScreens();
          this.showScreen("startScreen");
        }

        showScreen(screenId) {
          this.hideAllScreens();
          const screen = document.getElementById(screenId);
          if (screen) {
            screen.classList.add("active");
          }
        }

        hideAllScreens() {
          const screens = document.querySelectorAll(".screen");
          screens.forEach((screen) => screen.classList.remove("active"));
        }

        updateUI() {
          document.getElementById("score").textContent = this.score;
          document.getElementById("lives").textContent = this.lives;
          document.getElementById(
            "level"
          ).textContent = `${this.currentLevel}/${this.totalLevels}`;
          document.getElementById(
            "coinsDisplay"
          ).textContent = `${this.coinsCollected}/${this.totalCoins}`;
          document.getElementById("finalScore").textContent = this.score;
          document.getElementById("finalLevel").textContent = this.currentLevel;
          document.getElementById("coinsCollected").textContent =
            this.coinsCollected;
          document.getElementById("totalCoins").textContent = this.totalCoins;
          document.getElementById("bonusPoints").textContent =
            this.coinsCollected * 20;
          document.getElementById("victoryScore").textContent = this.score;
        }

        start() {
          if (this.state === "playing") return;

          this.state = "playing";
          this.running = true;
          this.lastTime = performance.now();
          this.showScreen("");

          // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
          this.gameLoop();

          console.log("–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å");
        }

        togglePause() {
          if (this.state === "playing") {
            this.state = "paused";
            this.showScreen("pauseScreen");
          } else if (this.state === "paused") {
            this.state = "playing";
            this.showScreen("");
            this.lastTime = performance.now();
            this.gameLoop();
          }
        }

        restart() {
          console.log("–†–µ—Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã...");

          this.score = 0;
          this.lives = 3;
          this.currentLevel = 1;
          this.loadCurrentLevel();
          this.state = "menu";
          this.showScreen("startScreen");
          this.updateUI();

          console.log("–ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞");
        }

        restartLevel() {
          console.log("–†–µ—Å—Ç–∞—Ä—Ç —É—Ä–æ–≤–Ω—è...");

          this.loadCurrentLevel();
          this.state = "playing";
          this.running = true;
          this.lastTime = performance.now();
          this.showScreen("");
          this.gameLoop();
        }

        gameOver() {
          this.state = "gameOver";
          this.running = false;
          this.showScreen("gameOverScreen");
          console.log("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞");
        }

        completeLevel() {
          this.state = "levelComplete";
          this.running = false;

          // –ë–æ–Ω—É—Å—ã
          const coinsBonus = this.coinsCollected * 20;
          const levelBonus = 100;
          this.score += coinsBonus + levelBonus;

          this.updateUI();
          this.showScreen("levelCompleteScreen");

          console.log(
            `–£—Ä–æ–≤–µ–Ω—å ${this.currentLevel} –ø—Ä–æ–π–¥–µ–Ω! –ë–æ–Ω—É—Å: ${
              coinsBonus + levelBonus
            } –æ—á–∫–æ–≤`
          );
        }

        victory() {
          this.state = "victory";
          this.running = false;

          // –§–∏–Ω–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å
          this.score += 500;

          this.updateUI();
          this.showScreen("victoryScreen");

          console.log("–í—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! –ü–æ–±–µ–¥–∞!");
        }

        nextLevel() {
          if (this.currentLevel < this.totalLevels) {
            this.currentLevel++;
            this.loadCurrentLevel();
            this.state = "playing";
            this.running = true;
            this.lastTime = performance.now();
            this.showScreen("");
            this.gameLoop();

            console.log(`–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å ${this.currentLevel}`);
          } else {
            this.victory();
          }
        }

        gameLoop() {
          if (!this.running || this.state !== "playing") return;

          const currentTime = performance.now();
          const deltaTime = Math.min(currentTime - this.lastTime, 100) / 1000;
          this.lastTime = currentTime;

          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
          this.update(deltaTime);

          // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
          this.render();

          // –°–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
          requestAnimationFrame(() => this.gameLoop());
        }

        update(deltaTime) {
          const player = this.player;

          // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
          if (this.keys["a"] || this.keys["arrowleft"]) {
            player.vx = -3; // Back to original speed for better gameplay
            player.facingRight = false;
          } else if (this.keys["d"] || this.keys["arrowright"]) {
            player.vx = 3; // Back to original speed for better gameplay
            player.facingRight = true;
          } else {
            player.vx *= 0.85;
            if (Math.abs(player.vx) < 0.1) player.vx = 0;
          }

          // –ü—Ä—ã–∂–æ–∫ (–ø–æ –æ–¥–∏–Ω–æ—á–Ω–æ–º—É –∏–ª–∏ –¥–≤–æ–π–Ω–æ–º—É –Ω–∞–∂–∞—Ç–∏—é)
          const isJumpKeyPressed =
            this.keys["w"] || this.keys[" "] || this.keys["arrowup"];
          const currentTime = Date.now();
          const doubleTapWindow = 300; // 300ms window for double tap

          if (isJumpKeyPressed) {
            // Check if it's a double tap within the time window
            if (
              currentTime - player.lastJumpTime < doubleTapWindow &&
              player.jumpTapCount === 1
            ) {
              // This is the second tap in a double tap
              if (player.jumpsUsed === 1) {
                // Only allow second jump if first was used
                player.vy = -10;
                player.jumpsUsed++;
                player.canJump = false;
                player.jumpTapCount = 0; // Reset tap count after successful double jump
              }
            }
            // Regular jump (first tap or after landing)
            else if (
              (player.onGround || player.jumpsUsed === 0) &&
              player.canJump
            ) {
              player.vy = -10;
              player.onGround = false;
              player.jumpsUsed = 1;
              player.canJump = false;
              player.jumpTapCount = 1; // Mark first tap
            }

            player.lastJumpTime = currentTime;
          }

          // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
          if (!player.onGround) {
            player.vy += 0.5;
            player.vy = Math.min(player.vy, 20);
          }

          // –î–≤–∏–∂–µ–Ω–∏–µ
          player.x += player.vx;
          player.y += player.vy;

          // –ì—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
          if (player.x < 0) {
            player.x = 0;
            player.vx = 0;
          }
          if (player.x > this.canvas.width - player.width) {
            player.x = this.canvas.width - player.width;
            player.vx = 0;
          }

          // –î–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º
          for (const platform of this.platforms) {
            if (platform.moving) {
              platform.x += platform.speed * 0.35;

              // –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≥—Ä–∞–Ω–∏—Ü
              if (platform.x <= platform.minX || platform.x >= platform.maxX) {
                platform.speed = -platform.speed;
              }
            }
          }

          // –ü–∞–¥–µ–Ω–∏–µ
          if (player.y > this.canvas.height) {
            this.lives--;
            if (this.lives <= 0) {
              this.gameOver();
            } else {
              // –†–µ—Å–ø–∞–≤–Ω –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ
              const level = this.levelData[this.currentLevel - 1];
              player.x = level.startX;
              player.y = level.startY;
              player.vx = 0;
              player.vy = 0;
              player.onGround = false;
              player.canJump = true;
              player.jumpsUsed = 0; // Reset jump count on respawn
              player.jumpTapCount = 0; // Reset tap count on respawn
              player.lastJumpTime = 0; // Reset last jump time on respawn
              this.updateUI();

              console.log(`–†–µ—Å–ø–∞–≤–Ω. –û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: ${this.lives}`);
            }
          }

          // –ö–æ–ª–ª–∏–∑–∏–∏ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
          let wasOnGround = player.onGround;
          player.onGround = false;
          for (const platform of this.platforms) {
            if (this.checkCollision(player, platform)) {
              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–æ—Ä–æ–Ω—É –∫–æ–ª–ª–∏–∑–∏–∏
              const playerBottom = player.y + player.height;
              const platformTop = platform.y;

              // –ü–∞–¥–µ–Ω–∏–µ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–≤–µ—Ä—Ö—É
              if (player.vy > 0 && playerBottom - player.vy <= platformTop) {
                player.y = platformTop - player.height;
                player.vy = 0;
                player.onGround = true;

                // –ï—Å–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–≤–∏–∂–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—è–µ–º –µ—ë —Å–∫–æ—Ä–æ—Å—Ç—å –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–∞
                if (platform.moving) {
                  player.vx += platform.speed * 0.15; // –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—Ç—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                }

                // –°–±—Ä–æ—Å –ø—Ä—ã–∂–∫–æ–≤ –ø—Ä–∏ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–∏
                if (!wasOnGround) {
                  player.jumpsUsed = 0;
                  player.jumpTapCount = 0; // Reset tap count when landing
                }
              }
              // –£–¥–∞—Ä –≥–æ–ª–æ–≤–æ–π —Å–Ω–∏–∑—É
              else if (player.vy < 0) {
                player.y = platformTop + platform.height;
                player.vy = 0;
              }
              // –ë–æ–∫–æ–≤—ã–µ –∫–æ–ª–ª–∏–∑–∏–∏
              else {
                if (player.vx > 0) {
                  // –î–≤–∏–≥–∞–ª—Å—è –≤–ø—Ä–∞–≤–æ
                  player.x = platform.x - player.width;
                  player.vx = 0;
                } else if (player.vx < 0) {
                  // –î–≤–∏–≥–∞–ª—Å—è –≤–ª–µ–≤–æ
                  player.x = platform.x + platform.width;
                  player.vx = 0;
                }
              }
            }
          }

          // –°–±–æ—Ä –º–æ–Ω–µ—Ç
          let collectedNewCoins = false;
          for (let i = this.coins.length - 1; i >= 0; i--) {
            const coin = this.coins[i];
            if (!coin.collected) {
              const dx = player.x + player.width / 2 - coin.x;
              const dy = player.y + player.height / 2 - coin.y;
              const distance = Math.sqrt(dx * dx + dy * dy);

              if (distance < 30) {
                coin.collected = true;
                this.score += 10;
                this.coinsCollected++;
                collectedNewCoins = true;
              }
            }
          }

          if (collectedNewCoins) {
            this.updateUI();
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∏—à–∞
          if (this.checkCollision(player, this.finish)) {
            if (this.coinsCollected >= this.totalCoins) {
              this.completeLevel();
            } else {
              // –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –º–æ–Ω–µ—Ç—ã
              const remaining = this.totalCoins - this.coinsCollected;
              console.log(`–°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ –º–æ–Ω–µ—Ç—ã! –û—Å—Ç–∞–ª–æ—Å—å: ${remaining}`);
            }
          }
        }

        checkCollision(obj1, obj2) {
          return (
            obj1.x < obj2.x + obj2.width &&
            obj1.x + obj1.width > obj2.x &&
            obj1.y < obj2.y + obj2.height &&
            obj1.y + obj1.height > obj2.y
          );
        }

        render() {
          const ctx = this.ctx;
          const player = this.player;

          // –û—á–∏—Å—Ç–∫–∞
          ctx.fillStyle = "#87CEEB"; // Light blue sky background like in pixel games
          ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

          // Draw pixel-style clouds
          ctx.fillStyle = "#FFFFFF";
          this.drawPixelCloud(ctx, 100, 80, 3);
          this.drawPixelCloud(ctx, 300, 120, 2);
          this.drawPixelCloud(ctx, 500, 70, 4);

          // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã - —Ç–µ–ø–µ—Ä—å –≤ –ø–∏–∫—Å–µ–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ
          for (const platform of this.platforms) {
            this.drawPixelPlatform(ctx, platform);
          }

          // –ú–æ–Ω–µ—Ç—ã - –≤ –ø–∏–∫—Å–µ–ª—å–Ω–æ–º ÔøΩÔøΩ—Ç–∏–ª–µ
          for (const coin of this.coins) {
            if (!coin.collected) {
              this.drawPixelCoin(ctx, coin);
            }
          }

          // –§–∏–Ω–∏—à - —Ñ–ª–∞–≥ –≤ –ø–∏–∫—Å–µ–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ
          this.drawPixelFlag(ctx, this.finish);

          // –ò–≥—Ä–æ–∫ - –≤ –ø–∏–∫—Å–µ–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ
          this.drawPixelPlayer(ctx, player);

          // UI –ø–æ–≤–µ—Ä—Ö
          ctx.fillStyle = "#000000";
          ctx.font = "bold 16px monospace";
          ctx.textAlign = "left";
          ctx.textBaseline = "top";
          ctx.fillText(
            `COINS: ${this.coinsCollected}/${this.totalCoins}`,
            10,
            10
          );
          ctx.fillText(`LEVEL: ${this.currentLevel}`, 10, 35);
          ctx.fillText(`SCORE: ${this.score}`, 10, 60);
        }

        drawPixelCloud(ctx, x, y, size) {
          ctx.fillStyle = "#FFFFFF";
          const blockSize = 8 * size;

          // Draw cloud with pixel blocks
          for (let row = 0; row < 2; row++) {
            for (let col = 0; col < 4 + row; col++) {
              if (row === 0 && (col === 0 || col === 4)) continue;

              ctx.fillRect(
                x + col * blockSize,
                y + row * blockSize,
                blockSize,
                blockSize
              );
            }
          }
        }

        drawPixelPlatform(ctx, platform) {
          // Main platform in green
          ctx.fillStyle = "#2ECC71";
          ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

          // Platform edge highlight
          ctx.fillStyle = "#27AE60";
          ctx.fillRect(platform.x, platform.y, platform.width, 2); // Top edge
          ctx.fillRect(
            platform.x,
            platform.y + platform.height - 2,
            platform.width,
            2
          ); // Bottom edge
          ctx.fillRect(platform.x, platform.y, 2, platform.height); // Left edge
          ctx.fillRect(
            platform.x + platform.width - 2,
            platform.y,
            2,
            platform.height
          ); // Right edge
        }

        drawPixelCoin(ctx, coin) {
          const time = Date.now() / 200;
          const pulse = Math.sin(time) * 2;
          const size = 8 + pulse;

          // Gold coin with pixel art style
          ctx.fillStyle = "#FFD700"; // Main gold
          ctx.fillRect(coin.x - size / 2, coin.y - size / 2, size, size);

          ctx.fillStyle = "#DAA520"; // Inner square
          ctx.fillRect(
            coin.x - size / 3,
            coin.y - size / 3,
            size * 0.66,
            size * 0.66
          );

          // Draw "C" in pixel style
          ctx.fillStyle = "#000";
          ctx.font = "bold " + size + "px monospace";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("C", coin.x, coin.y);
        }

        drawPixelFlag(ctx, finish) {
          // Flag pole
          ctx.fillStyle = "#C0C0C0";
          ctx.fillRect(finish.x, finish.y, 4, finish.height);

          // Flag
          ctx.fillStyle = "#FF0000";
          ctx.fillRect(finish.x + 4, finish.y, 20, 12);

          // Flag detail
          ctx.fillStyle = "#FFFF00";
          ctx.fillRect(finish.x + 6, finish.y + 2, 8, 4);
        }

        drawPixelPlayer(ctx, player) {
          ctx.save();

          if (!player.facingRight) {
            ctx.translate(player.x + player.width / 2, 0);
            ctx.scale(-1, 1);
            ctx.translate(-(player.x + player.width / 2), 0);
          }

          // Calculate leg animation offset based on horizontal movement
          const legAnimation =
            Math.abs(player.vx) > 0.5 ? Math.sin(Date.now() / 100) * 4 : 0;

          // Pixel art character - body parts as rectangles
          // Body
          ctx.fillStyle = "#3498DB"; // Blue shirt
          ctx.fillRect(player.x, player.y + 16, player.width, 24);

          // Head
          ctx.fillStyle = "#FDCB6E"; // Skin tone
          ctx.fillRect(player.x + 8, player.y, 16, 16);

          // Eyes
          ctx.fillStyle = "#2D3436";
          ctx.fillRect(player.x + 10, player.y + 4, 3, 3);
          ctx.fillRect(player.x + 19, player.y + 4, 3, 3);

          // Legs with animation
          ctx.fillStyle = "#E17055"; // Orange pants
          // Left leg - animated
          ctx.fillRect(player.x + 4, player.y + 40 + legAnimation, 8, 20);
          // Right leg - opposite animation
          ctx.fillRect(player.x + 20, player.y + 40 - legAnimation, 8, 20);

          // Arms (slightly animated with movement)
          ctx.fillStyle = "#3498DB"; // Same as shirt
          ctx.fillRect(player.x, player.y + 20, 4, 12); // Left arm
          ctx.fillRect(player.x + 28, player.y + 20, 4, 12); // Right arm

          // Hat (optional pixel art detail)
          ctx.fillStyle = "#E84393"; // Pink hat
          ctx.fillRect(player.x + 6, player.y - 4, 20, 6);

          ctx.restore();
        }
      }

      // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞ÔøΩÔøΩ—Ä—É–∑–∫–µ
      window.addEventListener("load", () => {
        console.log("–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É...");
        window.game = new SimpleGame();

        // –¢–µ—Å—Ç
        setTimeout(() => {
          console.log("–ì–æ—Ç–æ–≤–æ! –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: A/D - –¥–≤–∏–∂–µ–Ω–∏–µ, W/Space - –ø—Ä—ã–∂–æ–∫");
          console.log(
            "–í—Å–µ–≥–æ 3 —É—Ä–æ–≤–Ω—è. –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ –º–æ–Ω–µ—Ç—ã —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ —É—Ä–æ–≤–µ–Ω—å!"
          );
        }, 1000);
      });
    </script>
  </body>
</html>
